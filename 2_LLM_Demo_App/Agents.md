# Outdoor Adventure Gear Catalog Search

## About This File

**Primary Purpose:** This `Agents.md` file serves as both a **build specification** and a **demonstration** of how AI agents use specification documents. This file illustrates:

1. **What Agents.md files are:** Build specification documents that provide AI agents with complete, structured requirements for creating projects from scratch
2. **How AI agents use them:** Agents read this file to understand:
   - What to build (project goals and architecture)
   - How to structure it (file structure and organization)
   - What dependencies are needed (environment and packages)
   - How to implement each component (detailed module requirements)
   - How to verify the build (testing and validation steps)

This document demonstrates the level of detail, structure, and clarity needed for an AI agent to successfully build a complete project without prior knowledge of the codebase.

---

**Project:** Semantic Search Engine for Outdoor Adventure Gear  
**Goal:** Build a local semantic search engine for outdoor and adventure gear products that allows users to search by text queries or uploaded images, returning ranked product results with relevance scores.

**Document Type:** This is a **build specification document** for AI agents. It defines what must be created, not what currently exists. All file structures, components, and implementations described below are targets to be built from scratch.

**Transparency Note:** This specification document was generated by analyzing and reverse-engineering a previously built project. The detailed requirements, file structures, and implementation details documented here were derived from examining the existing codebase. While this document serves as a build specification for creating the project from scratch, it is important to acknowledge that its content reflects the structure and patterns of the original implementation.

---

## Build Configuration

**Configuration for this build:**

- **Project Root:** Create in current working directory
- **Utility Scripts:** Create `deploy.sh` and `destroy.sh` (see "Utility Scripts Requirements" section)
- **Documentation:** Create `README.md` (quick-start guide) and `Architecture.md` (technical architecture)
- **Ports:** 8000 (backend), 3000 (frontend) - check availability before starting, stop if occupied
- **Operating System:** macOS/Linux (bash scripts) - note if Windows detected (WSL needed)
- **Virtual Environment:** `backend/venv/` using `uv` (fallback to standard `venv` module)
- **Error Handling:** Stop on any build failure, report specific error and step
- **Model Downloads:** Require internet (~3-4GB), stop if downloads fail, report specific failures
- **File Permissions:** Set executable on all `.sh` scripts: `chmod +x deploy.sh destroy.sh`
- **Verification:** Run all verification steps and report actual results (deploy.sh, seed.py, destroy.sh)

---

## Project Overview

**System Type:** Semantic search/retrieval system (NOT RAG). Returns ranked product results, not generated text. No LLM generation step - only retrieval based on embedding similarity.

**Architecture:**
```
Admin Panel → Create Product → Generate Image → Generate Embedding → Store in Chroma DB
User Search → Query (Text/Image) → Generate Embedding → Similarity Search → Ranked Product Results
```

**Components:**
- **Product Catalog** → Admin-created outdoor gear products (text descriptions + images)
- **Embedding Models** → `all-MiniLM-L6-v2` for text embeddings, `BLIP` for image captioning
- **Vector Database** → Chroma for persistent storage and similarity search
- **API Layer** → FastAPI backend (port 8000)
- **Frontend** → React + TypeScript with Vite (port 3000), two views: Admin Panel (`/admin`) and User Search (`/`)

**Product Categories (Single-Level):**
- Tent
- Backpack
- Sleeping Bag
- Cooking

---

## Required File Structure

**IMPORTANT:** This section defines the target file structure that must be created during the build process. All files and directories listed below must be created as part of the project setup.

**Note:** The root directory name can be anything. All paths shown are relative to the project root. Directories marked as "auto-created" will be created automatically by the application code, but should be documented here for reference.

**Create the following directory structure and files:**

```
[Project Root]/
  ├── backend/                 # Backend Python package (MUST CREATE)
  │   ├── __init__.py          # Python package marker - CREATE (empty file)
  │   ├── embeddings.py        # Embedding model logic - CREATE
  │   ├── captioning.py        # BLIP image captioning logic - CREATE
  │   ├── search.py            # Similarity search with ChromaDB - CREATE
  │   ├── admin.py             # Product creation and image generation - CREATE
  │   ├── seed.py              # Database seeding script - CREATE
  │   ├── api.py               # FastAPI endpoints - CREATE
  │   ├── data/                # Data directory - CREATE
  │   │   └── seed_products.json  # Sample product data - CREATE (20 products)
  │   ├── static/              # Static files directory - CREATE (auto-created by api.py)
  │   │   └── products/        # Product images directory - CREATE (auto-created by admin.py)
  │   └── requirements.txt     # Python dependencies - CREATE
  ├── frontend/                # Frontend React application - CREATE
  │   ├── src/                 # Source directory - CREATE
  │   │   ├── App.tsx          # Main React component with routing - CREATE
  │   │   ├── main.tsx         # React entry point - CREATE (from Vite scaffold)
  │   │   ├── index.css        # Global styles - CREATE
  │   │   ├── vite-env.d.ts   # Vite type definitions - CREATE (from Vite scaffold)
  │   │   ├── components/      # UI components directory - CREATE
  │   │   │   ├── SearchForm.tsx        # CREATE
  │   │   │   ├── Results.tsx           # CREATE
  │   │   │   ├── TokenizationModal.tsx  # CREATE
  │   │   │   ├── AdminPanel.tsx        # CREATE
  │   │   │   └── PipelineDemo.tsx      # CREATE
  │   │   └── services/        # API service directory - CREATE
  │   │       └── api.ts       # API service functions - CREATE
  │   ├── vite.config.ts       # Vite configuration - CREATE/MODIFY (port 3000)
  │   ├── tsconfig.json        # TypeScript configuration - CREATE (from Vite scaffold)
  │   ├── tsconfig.node.json   # TypeScript config for Node - CREATE (from Vite scaffold)
  │   ├── index.html           # HTML entry point - CREATE (from Vite scaffold)
  │   └── package.json         # NPM package file - CREATE (from Vite scaffold, then modify)
  ├── deploy.sh                # Deployment script - CREATE (executable)
  ├── destroy.sh               # Teardown script - CREATE (executable)
  ├── README.md                # Project documentation - CREATE
  ├── Architecture.md          # Technical architecture docs - CREATE
  └── Agents.md                # This specification file - EXISTS (do not create)
```

---

## Environment & Dependencies

**Requirements:**
- Python 3.12 (required, no fallback)
- uv (Python package installer) or standard venv
- Node.js 18+ and npm
- Internet connection for initial model downloads (~3-4GB)

**Python Dependencies (backend/requirements.txt):**
```
sentence-transformers==2.2.2
transformers==4.35.0
torch>=2.2.0
chromadb==0.4.0
fastapi>=0.68.0,<0.111.0
uvicorn==0.24.0
pydantic>=1.9,<2.0
numpy==1.26.0
Pillow==10.1.0
python-multipart==0.0.6
```

**Frontend Dependencies (frontend/package.json):**
- React 18.2.0
- TypeScript 5.2.2
- Vite 5.0.8
- React Router DOM 6.20.0
- Recharts (for data visualization charts)

**Configuration:**
- Backend: Port 8000, CORS enabled for `http://localhost:3000` and `http://localhost:5173`
- Frontend: Port 3000, API base URL `http://localhost:8000`
- ChromaDB: Persistent storage in `backend/.chroma/` (auto-created)
- Static files: `backend/static/` served at `/static` route (auto-created)

---

## Models & Embeddings

**Text Embeddings:**
- Model: `sentence-transformers/all-MiniLM-L6-v2`
- Dimension: 384
- Usage: Generate embeddings for text queries and product descriptions
- Lazy loading: Model loads on first use

**Image Captioning:**
- Model: `Salesforce/blip-image-captioning-base` (BLIP)
- Pipeline: Image → BLIP → Text Caption → all-MiniLM-L6-v2 → Embedding
- Max caption length: 50 tokens
- Uses `BlipProcessor` and `BlipForConditionalGeneration` from `transformers`
- Runs with `torch.no_grad()` for CPU efficiency

**Vector Database:**
- ChromaDB with `PersistentClient` (ChromaDB 0.4.0+)
- Collection name: `"products"`
- Persistence: `backend/.chroma/` directory (auto-created)
- Stores: Embedding vectors (384-dim) + Metadata together in same record

**Metadata Format (Chroma storage):**
- `name`: String
- `description`: String
- `category`: String (Tent, Backpack, Sleeping Bag, Cooking)
- `price`: String (stored as string, converted to float in API responses)
- `features`: String (comma-separated, no spaces after commas, converted to array in API responses)
- `image_path`: String (relative path, e.g., "static/products/{product_id}.jpg")

---

## Backend Implementation

### Package Structure
When creating the backend package (see "Required File Structure" section):
- The `backend/` directory must be a Python package (requires `__init__.py` file)
- All modules must use relative imports: `from .embeddings import encode`
- The API must run as a module: `python -m uvicorn backend.api:app --host 0.0.0.0 --port 8000`

### Module Requirements

**embeddings.py (must create):**
When creating this file (see "Required File Structure"), it must implement:
- Function: `encode(text: str) -> List[float]`
  - Must use `SentenceTransformer('sentence-transformers/all-MiniLM-L6-v2')`
  - Must return 384-dimensional vector (list of floats)
  - Must implement lazy loading with global model instance (load on first `encode()` call)
  - Must import: `from sentence_transformers import SentenceTransformer`
- Function: `tokenize(text: str, return_tokens: bool = True, return_ids: bool = True) -> Dict[str, Any]`
  - Must expose tokenization using the same tokenizer as the embedding model
  - Must return: tokens, token_ids, token_count, word_count, character_count, token_mapping
  - Must demonstrate the tokenization step that happens before embedding generation
  - Must access tokenizer via `model.tokenizer` from SentenceTransformer instance

**captioning.py (must create):**
When creating this file (see "Required File Structure"), it must implement:
- Function: `generate_caption(image: Image.Image) -> str`
  - Must use `BlipProcessor.from_pretrained('Salesforce/blip-image-captioning-base')`
  - Must use `BlipForConditionalGeneration.from_pretrained('Salesforce/blip-image-captioning-base')`
  - Must process image: `processor(images=image, return_tensors="pt")`
  - Must generate: `model.generate(**inputs, max_length=50)`
  - Must decode: `processor.decode(generated_ids[0], skip_special_tokens=True)`
  - Must limit to max 50 tokens
  - Must run with `torch.no_grad()` context manager
  - Must implement lazy loading with global model instances (load on first call)

**search.py (must create):**
When creating this file (see "Required File Structure"), it must implement:
- Functions: 
  - `add_product(embedding, metadata, product_id)` - Must add product to ChromaDB
  - `search_products(query_embedding, top_k=5)` - Must search and return list of dicts with metadata + score
  - `get_product_count()` - Must return total count (int)
  - `get_product_count_by_category()` - Must return dict with category counts
- Must use `chromadb.PersistentClient(path=persist_directory)`
- Persist directory must be: `backend/.chroma/` (relative to search.py file location)
- Collection name must be: `"products"` (created if doesn't exist, loaded if exists)
- Similarity search must use: `collection.query()` with `query_embeddings`, `n_results=top_k`
- Must convert distance to similarity: `score = round(1 - distance, 2)`
- Must handle empty results: Return empty list if no products in collection
- Must convert metadata: Convert `features` from comma-separated string to array, `price` from string to float (or null)

**admin.py (must create):**
When creating this file (see "Required File Structure"), it must implement:
- Function: `create_product(name, description, category, price=None, features=None) -> Dict`
  - Must generate UUID for product ID using `uuid.uuid4()` (convert to string)
  - Must generate placeholder image (800x600 JPEG) with category-based colors:
    - Tent: #4A90E2 (Blue)
    - Backpack: #50C878 (Green)
    - Sleeping Bag: #FF6B6B (Red)
    - Cooking: #FFA500 (Orange)
    - Default: #808080 (Gray)
  - Image must display: Product name in white, bold font, centered (use Pillow's ImageDraw)
  - Must create directory if needed: `os.makedirs(image_dir, exist_ok=True)`
  - Must save to `backend/static/products/{product_id}.jpg` (directory will be auto-created)
  - Must generate embedding from description using `embeddings.encode(description)`
  - Must convert features to comma-separated string (no spaces after commas) for Chroma storage
  - Must convert price to string (empty string if None) for Chroma storage
  - Must store in ChromaDB using `search.add_product(embedding, metadata, product_id)`
  - Must return product dict with: id (str), name, description, category, price (float or None), features (array), image_path (str)

**seed.py (must create):**
When creating this file (see "Required File Structure"), it must:
- Handle both direct execution (`python seed.py`) and module execution (`python -m backend.seed`)
- Use the complete implementation template provided below

**api.py (must create):**
When creating this file (see "Required File Structure"), it must implement:
- FastAPI app with CORS middleware
  - Must allow origins: `["http://localhost:3000", "http://localhost:5173"]`
  - Must allow methods: `["GET", "POST"]`
  - Must allow headers: `["*"]`
- Must mount static files: `app.mount("/static", StaticFiles(directory="backend/static"), name="static")`
- Must use Pydantic models for request/response validation (use Pydantic v1 syntax: `BaseModel`, not v2)
- Must implement endpoints (see API Specification below)
- Must handle errors: Return HTTPException with appropriate status codes
- Must use import pattern: `from fastapi import FastAPI, HTTPException, UploadFile, File, Form`
- Must import static files: `from fastapi.staticfiles import StaticFiles`
- Must import CORS: `from fastapi.middleware.cors import CORSMiddleware`

---

## Seed Script Implementation

**seed.py** must handle dual execution contexts. Complete template:

```python
"""
Database seeding script to load sample products from seed_products.json.
Run this from the backend directory: python seed.py
Or run as a module from project root: python -m backend.seed
"""

import json
import os
import sys

# Handle imports - work whether run directly or as module
if __name__ == "__main__":
    # When run directly, add parent to path and import as package
    _backend_dir = os.path.dirname(os.path.abspath(__file__))
    _parent_dir = os.path.dirname(_backend_dir)
    if _parent_dir not in sys.path:
        sys.path.insert(0, _parent_dir)
    from backend.admin import create_product
else:
    # Use relative import when run as module
    from .admin import create_product

# Get the directory where this file is located
_current_dir = os.path.dirname(os.path.abspath(__file__))
_data_file = os.path.join(_current_dir, "data", "seed_products.json")


def seed_database():
    """Load and create products from seed_products.json."""
    if not os.path.exists(_data_file):
        print(f"Error: {_data_file} not found")
        return 0, 1
    
    with open(_data_file, 'r') as f:
        products = json.load(f)
    
    created = 0
    errors = 0
    
    for product_data in products:
        try:
            create_product(
                name=product_data['name'],
                description=product_data['description'],
                category=product_data['category'],
                price=product_data.get('price'),
                features=product_data.get('features', [])
            )
            created += 1
            print(f"Created: {product_data['name']}")
        except Exception as e:
            errors += 1
            print(f"Error creating {product_data.get('name', 'unknown')}: {e}")
    
    print(f"\nSeeding complete: {created} created, {errors} errors")
    return created, errors


if __name__ == "__main__":
    seed_database()
```

---

## Seed Products Data

**File:** `backend/data/seed_products.json`

**Structure:** JSON array of product objects. Each product has:
- `name`: String (required)
- `description`: String (required)
- `category`: String (required) - Tent, Backpack, Sleeping Bag, or Cooking
- `price`: Number (optional)
- `features`: Array of strings (optional)

**Required:** 20 products total (5 per category)

**Complete data:**

```json
[
  {
    "name": "Ultralight 2-Person Tent",
    "description": "Lightweight backpacking tent weighing only 2.1 lbs, perfect for multi-day trips. Features waterproof material and easy setup.",
    "category": "Tent",
    "price": 249.99,
    "features": ["Ultralight", "Waterproof", "2-person capacity"]
  },
  {
    "name": "Compact Backpacking Tent",
    "description": "Lightweight and compact design perfect for solo backpackers. Easy to set up and pack down small.",
    "category": "Tent",
    "price": 189.99,
    "features": ["Lightweight", "Compact", "Easy setup"]
  },
  {
    "name": "Family Camping Tent",
    "description": "Spacious 6-person tent ideal for family camping trips. Features multiple rooms and excellent ventilation.",
    "category": "Tent",
    "price": 349.99,
    "features": ["6-person capacity", "Multiple rooms", "Great ventilation"]
  },
  {
    "name": "Winter 4-Season Tent",
    "description": "Durable 4-season tent designed for harsh weather conditions. Perfect for winter camping and mountaineering.",
    "category": "Tent",
    "price": 499.99,
    "features": ["4-season", "Weatherproof", "Durable"]
  },
  {
    "name": "Budget-Friendly Tent",
    "description": "Affordable tent perfect for beginners. Easy to set up and provides reliable shelter for weekend camping trips.",
    "category": "Tent",
    "price": 89.99,
    "features": ["Affordable", "Easy setup", "Beginner-friendly"]
  },
  {
    "name": "Ultralight Hiking Backpack",
    "description": "Lightweight backpack designed for long-distance hiking. Features multiple compartments and comfortable suspension system.",
    "category": "Backpack",
    "price": 199.99,
    "features": ["Ultralight", "Multiple compartments", "Comfortable"]
  },
  {
    "name": "Daypack for Day Hikes",
    "description": "Compact daypack perfect for day hikes and short adventures. Lightweight with hydration system compatibility.",
    "category": "Backpack",
    "price": 79.99,
    "features": ["Compact", "Hydration compatible", "Lightweight"]
  },
  {
    "name": "Heavy-Duty Backpacking Pack",
    "description": "Large capacity backpack for extended backpacking trips. Durable construction with excellent weight distribution.",
    "category": "Backpack",
    "price": 279.99,
    "features": ["Large capacity", "Durable", "Weight distribution"]
  },
  {
    "name": "Waterproof Hiking Backpack",
    "description": "Fully waterproof backpack ideal for wet weather conditions. Keeps your gear dry in any weather.",
    "category": "Backpack",
    "price": 229.99,
    "features": ["Waterproof", "Weather-resistant", "Durable"]
  },
  {
    "name": "Budget Backpack",
    "description": "Affordable backpack perfect for casual hikers and weekend adventures. Comfortable and functional design.",
    "category": "Backpack",
    "price": 59.99,
    "features": ["Affordable", "Comfortable", "Functional"]
  },
  {
    "name": "Ultralight Sleeping Bag",
    "description": "Lightweight sleeping bag perfect for backpacking. Compresses small and provides excellent warmth-to-weight ratio.",
    "category": "Sleeping Bag",
    "price": 179.99,
    "features": ["Ultralight", "Compressible", "Warm"]
  },
  {
    "name": "Winter Sleeping Bag",
    "description": "Heavy-duty sleeping bag rated for cold weather camping. Keeps you warm in temperatures down to -10°F.",
    "category": "Sleeping Bag",
    "price": 249.99,
    "features": ["Cold weather", "Warm", "Durable"]
  },
  {
    "name": "3-Season Sleeping Bag",
    "description": "Versatile sleeping bag suitable for spring, summer, and fall camping. Comfortable temperature range from 20°F to 60°F.",
    "category": "Sleeping Bag",
    "price": 149.99,
    "features": ["3-season", "Versatile", "Comfortable"]
  },
  {
    "name": "Budget Sleeping Bag",
    "description": "Affordable sleeping bag perfect for casual campers. Provides basic warmth and comfort for summer camping.",
    "category": "Sleeping Bag",
    "price": 49.99,
    "features": ["Affordable", "Basic warmth", "Summer use"]
  },
  {
    "name": "Mummy Sleeping Bag",
    "description": "Lightweight mummy-style sleeping bag with excellent heat retention. Perfect for backpacking and cold weather.",
    "category": "Sleeping Bag",
    "price": 199.99,
    "features": ["Mummy style", "Lightweight", "Heat retention"]
  },
  {
    "name": "Portable Camping Stove",
    "description": "Compact and lightweight camping stove perfect for backpacking. Easy to use and fuel-efficient.",
    "category": "Cooking",
    "price": 89.99,
    "features": ["Portable", "Lightweight", "Fuel-efficient"]
  },
  {
    "name": "Camping Cookware Set",
    "description": "Complete cookware set including pots, pans, and utensils. Perfect for preparing meals while camping.",
    "category": "Cooking",
    "price": 129.99,
    "features": ["Complete set", "Durable", "Non-stick"]
  },
  {
    "name": "Collapsible Camping Kettle",
    "description": "Space-saving collapsible kettle for boiling water. Perfect for coffee, tea, and dehydrated meals.",
    "category": "Cooking",
    "price": 39.99,
    "features": ["Collapsible", "Space-saving", "Lightweight"]
  },
  {
    "name": "Camping Coffee Maker",
    "description": "Portable coffee maker for brewing great coffee while camping. Lightweight and easy to use.",
    "category": "Cooking",
    "price": 59.99,
    "features": ["Portable", "Easy to use", "Lightweight"]
  },
  {
    "name": "Camping Utensil Set",
    "description": "Compact utensil set including fork, knife, and spoon. Lightweight and perfect for backpacking.",
    "category": "Cooking",
    "price": 19.99,
    "features": ["Compact", "Lightweight", "Complete set"]
  }
]
```

---

## API Specification

### GET /health
**Response:**
```json
{
  "status": "healthy",
  "product_count": 20
}
```

### GET /admin/stats
**Response:**
```json
{
  "total": 20,
  "by_category": {
    "Tent": 5,
    "Backpack": 5,
    "Sleeping Bag": 5,
    "Cooking": 5
  }
}
```

### POST /admin/seed
**Response:**
```json
{
  "success": true,
  "message": "Successfully seeded 20 products",
  "created": 20,
  "errors": 0
}
```
**Process:** Reads `backend/data/seed_products.json`, calls `create_product()` for each, returns counts.

### POST /admin/products
**Request:**
```json
{
  "name": "Ultralight 2-Person Tent",
  "description": "Lightweight backpacking tent...",
  "category": "Tent",
  "price": 249.99,
  "features": ["Ultralight", "Waterproof", "2-person capacity"]
}
```
**Response:**
```json
{
  "success": true,
  "product": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "name": "Ultralight 2-Person Tent",
    "description": "Lightweight backpacking tent...",
    "image_path": "static/products/550e8400-e29b-41d4-a716-446655440000.jpg",
    "category": "Tent",
    "price": 249.99,
    "features": ["Ultralight", "Waterproof", "2-person capacity"]
  }
}
```

### POST /search
**Request:**
```json
{
  "query": "lightweight backpacking tent",
  "top_k": 5
}
```
**Response:**
```json
{
  "query_caption": "lightweight backpacking tent",
  "results": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "name": "Ultralight 2-Person Tent",
      "description": "Lightweight backpacking tent...",
      "image_path": "static/products/550e8400-e29b-41d4-a716-446655440000.jpg",
      "category": "Tent",
      "price": 249.99,
      "features": ["Ultralight", "Waterproof", "2-person capacity"],
      "score": 0.92
    }
  ]
}
```
**Note:** If no products match, return empty `results` array: `{"query_caption": "...", "results": []}`

### POST /search/image
**Request:** multipart/form-data
- `file`: Image file (JPG/PNG, max 5MB) - required
- `top_k`: Number (optional, default: 5) - can be sent as form field or query parameter

**Validation:**
- File type: Must be JPG/PNG (check `content_type` or file extension)
- File size: Max 5MB (check `file.size` or read and check length)
- Return HTTP 400 if validation fails

**Response:** Same structure as POST /search, but `query_caption` contains BLIP-generated caption.

**Search Process:**
1. Text: Generate embedding directly from query
2. Image: Generate caption with BLIP → generate embedding from caption
3. Chroma similarity search (cosine distance, converted to similarity score: 1 - distance)
4. Return top-K results with metadata and scores

### POST /debug/tokenize
**Request:**
```json
{
  "text": "lightweight backpacking tent"
}
```
**Response:**
```json
{
  "original_text": "lightweight backpacking tent",
  "token_count": 6,
  "token_count_no_special": 4,
  "word_count": 3,
  "character_count": 28,
  "tokens": ["lightweight", "backpacking", "tent"],
  "tokens_with_special": ["[CLS]", "lightweight", "backpacking", "tent", "[SEP]"],
  "token_ids": [101, 12345, 67890, 11111, 102],
  "token_ids_no_special": [12345, 67890, 11111],
  "token_mapping": [
    {"token": "lightweight", "token_id": 12345, "position": 1},
    {"token": "backpacking", "token_id": 67890, "position": 2},
    {"token": "tent", "token_id": 11111, "position": 3}
  ]
}
```
**Purpose:** Educational endpoint to demonstrate tokenization. Shows how text is broken into tokens before embedding generation, including token strings, token IDs, special tokens ([CLS], [SEP]), and token-to-ID mapping.

### POST /debug/embedding (Optional - for Pipeline Demo)
**Request:**
```json
{
  "text": "lightweight backpacking tent"
}
```
**Response:**
```json
{
  "text": "lightweight backpacking tent",
  "embedding": [0.123, -0.456, 0.789, ...],
  "dimension": 384,
  "first_n_dimensions": [0.123, -0.456, 0.789, 0.234, -0.567],
  "statistics": {
    "min": -0.789,
    "max": 0.789,
    "mean": 0.001,
    "std": 0.123
  }
}
```
**Purpose:** Optional endpoint for Pipeline Demo page to show embedding generation step. Returns embedding vector, dimension count, preview of first N dimensions, and basic statistics. Can also be implemented client-side using existing `encode()` function.

### POST /debug/similarity (Optional - for Pipeline Demo)
**Request:**
```json
{
  "texts": ["text1", "text2", "text3"]
}
```
**Response:**
```json
{
  "similarity_matrix": [
    [1.0, 0.85, 0.12],
    [0.85, 1.0, 0.15],
    [0.12, 0.15, 1.0]
  ],
  "texts": ["text1", "text2", "text3"],
  "pairwise_similarities": [
    {"text1": "text1", "text2": "text2", "similarity": 0.85},
    {"text1": "text1", "text2": "text3", "similarity": 0.12},
    {"text1": "text2", "text2": "text3", "similarity": 0.15}
  ]
}
```
**Purpose:** Optional endpoint for Pipeline Demo page to calculate and return similarity matrix for multiple texts. Can also be implemented client-side by generating embeddings and calculating cosine similarity.

---

## Frontend Implementation

### Scaffolding
**Recommended:** Use Vite scaffold: `npm create vite@latest frontend -- --template react-ts`

**Then modify:**
- Add `react-router-dom` dependency
- Update `vite.config.ts` (see "Required File Structure"): must set port 3000
- Replace `App.tsx` (see "Required File Structure") with routing and custom components
- Replace `index.css` (see "Required File Structure") with custom styles
- Create `services/api.ts` (see "Required File Structure") with API functions
- Create components (see "Required File Structure"): `SearchForm.tsx`, `Results.tsx`, `AdminPanel.tsx`, `PipelineDemo.tsx`, `TokenizationModal.tsx`

### Design System & Common Look-and-Feel

**IMPORTANT:** All views must maintain a consistent design language and user experience. The following guidelines ensure a cohesive look-and-feel across Search, Admin, and Pipeline Demo views.

#### Color Scheme
- **Primary Color:** `#4A90E2` (Blue) - Used for primary buttons, active navigation, links, and accents
- **Secondary Colors (Category-based):**
  - Tent: `#4A90E2` (Blue)
  - Backpack: `#50C878` (Green)
  - Sleeping Bag: `#FF6B6B` (Red)
  - Cooking: `#FFA500` (Orange)
- **Success:** `#28a745` (Green) - Used for success messages and seed button
- **Error:** `#721c24` (Dark Red) - Used for error messages
- **Neutral:** `#808080` (Gray) - Used for default/fallback states
- **Background:** `#ffffff` (White) for main content, `#f9f9f9` for form backgrounds
- **Text:** `#213547` (Dark Gray) for primary text, `#666` for secondary text

#### Typography
- **Font Family:** System fonts (`system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif`)
- **Headings:**
  - H1: `2.5rem`, bold, color `#1a1a1a`
  - H2: `1.8rem`, bold, color `#1a1a1a`
  - H3: `1.3rem`, bold, color `#1a1a1a`
- **Body Text:** `1rem`, line-height `1.5`, color `#213547`
- **Secondary Text:** `0.875rem`, color `#666`

#### Spacing & Layout
- **Container Padding:** `2rem` for main content areas
- **Component Spacing:** `1.5rem` between major sections, `1rem` between related elements
- **Form Spacing:** `1.5rem` margin-bottom for form groups
- **Card Padding:** `1rem` to `1.5rem` for card content
- **Max Width:** `1200px` for main content container (centered)

#### Buttons
- **Primary Buttons:**
  - Background: Gradient from `#4A90E2` to `#357ABD` (or solid `#4A90E2`)
  - Color: White
  - Padding: `0.75rem 1.5rem`
  - Font size: `1rem` to `1.1rem`
  - Font weight: `500` to `600`
  - Border radius: `4px` to `6px`
  - Box shadow: `0 2px 4px rgba(74, 144, 226, 0.3)`
  - Hover: Darker shade, enhanced shadow, slight transform (`translateY(-1px)`)
  - Disabled: Gray background (`#ccc`), no shadow, no transform
- **Secondary Buttons:**
  - Background: `#6c757d` (Gray) or category-specific colors
  - Same padding and styling as primary, but different background
- **Button Container:** Horizontal flex layout with gap `1rem`

#### Cards & Containers
- **Card Style:**
  - Background: White
  - Border: `1px solid #ddd` or subtle shadow (`0 2px 4px rgba(0, 0, 0, 0.1)`)
  - Border radius: `8px`
  - Padding: `1rem` to `1.5rem`
  - Hover effect: `translateY(-2px)`, enhanced shadow
- **Form Containers:**
  - Background: `#f9f9f9`
  - Padding: `2rem`
  - Border radius: `8px`
  - Box shadow: `0 2px 4px rgba(0, 0, 0, 0.1)`

#### Input Fields
- **Text Inputs, Textareas, Selects:**
  - Width: `100%`
  - Padding: `0.75rem`
  - Font size: `1rem`
  - Border: `2px solid #ddd`
  - Border radius: `4px`
  - Focus: Border color `#4A90E2`, no outline
- **Labels:**
  - Display: Block
  - Margin-bottom: `0.5rem`
  - Font weight: `500`

#### Navigation
- **Nav Bar:**
  - Background: `#1a1a1a` (Dark)
  - Padding: `1rem 2rem`
  - Links: White text, `0.5rem 1rem` padding, `4px` border radius
  - Active link: Background `#4A90E2`, white text
  - Hover: `rgba(255, 255, 255, 0.1)` background

#### Messages & Alerts
- **Success Messages:**
  - Background: `#d4edda`
  - Text: `#155724`
  - Padding: `1rem`
  - Border radius: `4px`
- **Error Messages:**
  - Background: `#f8d7da`
  - Text: `#721c24`
  - Padding: `1rem`
  - Border radius: `4px`

#### Modals
- **Modal Overlay:**
  - Background: `rgba(0, 0, 0, 0.5)`
  - Full screen, centered content
- **Modal Content:**
  - Background: White
  - Border radius: `8px`
  - Max width: `90vw`, max height: `90vh`
  - Box shadow: `0 4px 16px rgba(0, 0, 0, 0.2)`
- **Modal Header:**
  - Border-bottom: `1px solid #ddd`
  - Padding: `1.5rem`
- **Modal Body:**
  - Padding: `1.5rem`

#### Responsive Design
- **Breakpoint:** `1024px` for layout changes
- **Below 1024px:**
  - Admin panel switches from 2-column to single column
  - Cards stack vertically
  - Navigation remains horizontal (may wrap on very small screens)
- **All views must be responsive and work on mobile, tablet, and desktop**

#### Consistent Patterns Across Views
1. **Page Headers:** All views use H1 with consistent styling (`2.5rem`, bold, `#1a1a1a`)
2. **Section Headers:** H2 (`1.8rem`) for major sections, H3 (`1.3rem`) for subsections
3. **Button Styling:** All primary action buttons use the same gradient blue style
4. **Card Layout:** Product cards, category cards, and result cards use consistent styling
5. **Form Styling:** All forms use the same input, label, and button styles
6. **Loading States:** Disabled buttons with "Loading..." or "Processing..." text
7. **Empty States:** Consistent messaging and styling when no data is available
8. **Error Handling:** All views display errors in the same red alert style
9. **Success Feedback:** All views display success messages in the same green alert style
10. **Spacing:** Consistent margins and padding throughout all views

#### Visual Hierarchy
- **Primary Actions:** Large, prominent buttons with gradient backgrounds
- **Secondary Actions:** Smaller buttons with solid colors
- **Information Display:** Cards with subtle shadows and borders
- **Interactive Elements:** Clear hover states and transitions
- **Content Sections:** Clear separation with consistent spacing

#### Accessibility
- **Color Contrast:** Ensure sufficient contrast for text readability
- **Focus States:** Visible focus indicators on all interactive elements
- **Button Labels:** Clear, descriptive button text
- **Form Labels:** All inputs have associated labels
- **Error Messages:** Clear, actionable error messages

### Component Requirements

**App.tsx (must create/modify):**
When creating or modifying this file (see "Required File Structure"), it must:
- Implement React Router with routes: `/` (SearchPage), `/admin` (AdminPanel), and `/demo` (PipelineDemo)
- Include navigation component with active route highlighting for all three routes
- Implement SearchPage component that manages search state and passes searchResponse to SearchForm

**SearchForm.tsx (must create):**
When creating this file (see "Required File Structure"), it must:
- Provide text input OR image upload (mutually exclusive - use radio buttons or tabs to switch)
- Implement file validation: JPG/PNG, max 5MB (client-side validation before upload)
- Use file input with: `accept="image/jpeg,image/png"`
- Include button container with horizontal layout:
  - Search button on the left (disabled during loading)
  - Optional: "Show Tokenization" button to demonstrate tokenization (calls `/debug/tokenize` endpoint)
- Handle loading state (show spinner/disable inputs)
- Display errors for validation failures
- Accept optional prop: `searchResponse` to conditionally display tokenization button
- Implement tokenization visualization: When "Show Tokenization" is clicked, display tokenization results in an expandable section or modal showing:
  - Original text
  - Token breakdown (tokens with special tokens highlighted)
  - Token IDs
  - Token count vs word count comparison
  - Token-to-ID mapping table

**Results.tsx (must create):**
When creating this file (see "Required File Structure"), it must:
- Display query caption ("Searching for: ...")
- Render product cards with: image (from full URL), name, category, description (truncated), price (formatted with $), features (list), score (optional/expandable)
- Show empty state when no search performed yet
- Show empty results message when search returns no matches
- Load images using full URL: `http://localhost:8000/${product.image_path}`

**TokenizationModal.tsx (must create):**
When creating this file (see "Required File Structure"), it must:
- Implement modal overlay showing tokenization breakdown
- Display original text
- Show tokens with visual distinction for special tokens ([CLS], [SEP])
- Display token IDs in a table or list format
- Show statistics: token count, word count, character count
- Include token-to-ID mapping in an organized table
- Include close button

**PipelineDemo.tsx (must create):**
When creating this file (see "Required File Structure"), it must:
- Implement educational page demonstrating the LLM pipeline in a search context: Search Query → Tokens → Embeddings → Similarity Search → Results
- Provide interactive step-by-step demonstration matching Notebook 1 concepts, applied to a practical search scenario
- Primary goal: Must demonstrate LLM pipeline concepts from notebooks in a working full-stack application
- Layout: Must use vertical flow showing each pipeline stage with search query as input
- **Step 1: Search Query Input Section**
  - Single search query input field (text input, not multiple text inputs)
  - Placeholder text suggesting example queries (e.g., "lightweight backpacking tent")
  - "Load Example Query" button to populate input with sample search query ("lightweight backpacking tent")
  - "Process Pipeline" button to start demonstration (disabled when query is empty or processing)
  - Enter key support to trigger processing when input is focused
  - Query input is the starting point for the entire pipeline demonstration
  - Loading state disables input and buttons during processing
- **Step 2: Tokenization Section**
  - Displayed after search query is processed (when step >= 1 and tokenizationResult exists)
  - Show tokenization results for the search query
  - Display original query text prominently
  - Visual token breakdown with special tokens highlighted ([CLS], [SEP]) using different styling
  - Token-to-ID mapping table showing position, token, and token ID for each token
  - Statistics display: token count (with and without special tokens), word count, character count
  - Educational explanation of how text is broken into tokens and mapped to numerical IDs
- **Step 3: Embedding Generation Section**
  - Displayed after tokenization completes (when step >= 2 and embeddingResult exists)
  - Show that 384-dimensional embedding vector is generated from the query
  - Display first 10 dimensions as preview (showing sample values from the vector)
  - Show embedding statistics: dimension count (384), min value, max value, mean value, standard deviation
  - Educational note explaining that the vector captures semantic meaning in high-dimensional space
  - Note that full 384-dim vector is used internally for similarity search
- **Step 4: Similarity Search Section**
  - Displayed after embedding generation completes (when step >= 3 and searchResult exists)
  - Query embedding is compared against all product embeddings in the database using cosine similarity
  - Display search results with similarity scores (top 5 products by default)
  - Show ranked product results ordered by similarity score (highest first)
  - **Similarity Score Bar Chart:**
    - Visual bar chart showing similarity scores for all matching products
    - X-axis: Product names (truncated if too long, with tooltip showing full name)
    - Y-axis: Similarity score (0 to 1.0)
    - Bars colored to match app theme (blue)
    - Tooltip shows full product name, category, and similarity percentage
    - Chart helps visualize ranking and makes it easy to see which products match best
    - Educational value: Makes abstract similarity scores concrete and visual
  - For each product result, display:
    - Product name (heading) and category (badge)
    - Similarity score displayed prominently in highlighted box (e.g., "Similarity: 0.73")
    - Product description (full text)
    - Price (formatted with $ symbol) if available
    - Features list (comma-separated) if available
    - Educational explanation of what the similarity score means (scores closer to 1.0 = better matches)
  - If no results found, display appropriate "no products found" message
  - Results demonstrate how the query embedding matches against product embeddings stored in ChromaDB
  - Each result card styled with clear visual hierarchy and similarity score prominently displayed
- **Completion Message:**
  - Displayed after all steps complete (when step >= 4 and not loading)
  - Success message confirming pipeline processing complete
  - Summary of the complete pipeline flow: Text → Tokens → Embeddings → Similarity Search → Ranked Results
- **Design Requirements:**
  - Step-by-step progression with clear visual separation between steps
  - Each step appears sequentially after processing completes
  - Loading states for each processing step (buttons disabled, "Processing..." text)
  - Error handling and display (error messages shown prominently)
  - Responsive design matching Search and Admin pages
  - Educational styling with clear labels and explanations
  - Use same color scheme and design language as rest of app
  - Similarity scores displayed prominently with visual distinction (highlighted boxes)
  - Product results styled as cards with clear hierarchy and borders
  - Query display with highlighted background
  - Statistics displayed in organized stat items
- **API Integration:**
  - Call `/debug/tokenize` endpoint for tokenization step (POST with text in request body)
  - Call `/debug/embedding` endpoint for embedding generation step (POST with text in request body)
  - Call `/search` endpoint for similarity search (POST with query and top_k, returns products with similarity scores)
  - Handle errors gracefully with user-friendly messages displayed in error message div
  - All API calls use async/await with try/catch error handling
- **State Management:**
  - searchQuery: string state for the search input
  - step: number state tracking current pipeline step (0-4)
  - loading: boolean state for processing indicator
  - error: string state for error messages
  - tokenizationResult: TokenizeResponse state for tokenization data
  - embeddingResult: EmbeddingResponse state for embedding data
  - searchResult: SearchResponse state for search results
- **Educational Focus:**
  - Demonstrates complete pipeline: Query → Tokens → Embeddings → Similarity → Results
  - Shows practical application of LLM pipeline concepts in a search context
  - Connects educational concepts to real-world functionality
  - Makes abstract concepts (tokens, embeddings, similarity) concrete and visible
  - Shows how semantic search works under the hood
  - Demonstrates how similar queries match similar products through embedding similarity

**AdminPanel.tsx (must create):**
When creating this file (see "Required File Structure"), it must:
- Implement traditional horizontal admin dashboard layout (two-column grid):
  - Left column: Statistics dashboard with enhanced visual styling
    - Must display total products in prominent gradient card (blue gradient background, large bold number)
    - Must show category breakdown in color-coded cards matching backend category colors:
      - Tent: Blue (#4A90E2)
      - Backpack: Green (#50C878)
      - Sleeping Bag: Red (#FF6B6B)
      - Cooking: Orange (#FFA500)
    - Category cards must be displayed in 2-column grid layout with hover effects
    - Must use card-based design with shadows, borders, and modern styling
    - Must have improved typography, spacing, and visual hierarchy
    - Statistics section must be sticky (remains visible when scrolling)
    - Must show "Seed Data" button when total = 0 (styled with hover effects)
  - Right column: Product creation form
    - Must include form fields: name, description, category (dropdown), price, features (comma-separated)
    - Category and price fields must be displayed side-by-side in a row
    - Must implement form validation
    - Must display success/error messages
    - Must auto-refresh stats after actions
- Must implement responsive design: Layout switches to single column on smaller screens (below 1024px width)

**api.ts (must create):**
When creating this file (see "Required File Structure"), it must:
- Use base URL: `http://localhost:8000`
- Implement functions: `createProduct()`, `searchByText()`, `searchByImage()`, `getProductStats()`, `seedDatabase()`, `tokenizeText()`, `generateEmbedding()`, `calculateSimilarity()`
- Include error handling with `handleResponse<T>()` helper
- Define TypeScript interfaces for: Product, SearchResponse, StatsResponse, TokenizeResponse, EmbeddingResponse, SimilarityResponse
- Handle image upload: Use `FormData` for multipart/form-data
- Construct image URLs: Use full URL `http://localhost:8000/${image_path}`
- Implement tokenization function: Must call `/debug/tokenize` endpoint for educational demonstration
- Implement embedding function: Must generate embeddings for pipeline demo (can reuse existing encode logic or add dedicated endpoint)
- Implement similarity function: Must calculate cosine similarity between embedding vectors (can be client-side calculation or API endpoint)

**TypeScript Import Guidelines:**
When implementing components that use `api.ts`:
- Must use `import type` for TypeScript interfaces/types from `api.ts` in components
- Functions can be imported normally (they're runtime values)
- Example: Import functions normally, but use `import type { InterfaceName }` for interfaces
- This prevents runtime errors since TypeScript interfaces are compile-time only and don't exist at runtime
- Components must import functions normally but use `import type` for interfaces (e.g., `SearchResponse`, `Product`, `StatsResponse`, `TokenizeResponse`)

---

## Utility Scripts Requirements

**All scripts must be executable:** `chmod +x deploy.sh destroy.sh`

### deploy.sh
**Purpose:** Automated setup and deployment
**Requirements:**
- Check prerequisites (uv, Python 3.12, Node.js, npm)
- Create Python virtual environment using `uv venv --python python3.12` (or standard venv)
- Install backend dependencies from `requirements.txt`
- Install frontend dependencies (`npm install`)
- Start FastAPI backend on port 8000 in background (save PID to `backend.pid`)
- Start Vite frontend on port 3000 in background (save PID to `frontend.pid`)
- Redirect output to log files: `backend.log` and `frontend.log`
- Exit after starting services

### destroy.sh
**Purpose:** Gracefully stop all services and clean up all generated files
**Requirements:**
- Stop backend server using PID file or port detection (port 8000)
- Stop frontend server using PID file or port detection (port 3000)
- Remove PID files (`backend.pid`, `frontend.pid`)
- Remove log files (`backend.log`, `frontend.log`)
- Remove Python cache (`__pycache__`, `*.pyc`)
- Remove virtual environment (`backend/venv/`, `backend/.venv/`)
- Remove Chroma database (`backend/.chroma/`)
- Remove product images (`backend/static/products/*`)
- Remove `node_modules` (`frontend/node_modules/`)
- Remove build artifacts (`frontend/dist/`)
- Report completion status for each step

---

## Build Process

**IMPORTANT:** Follow the "Required File Structure" section above to ensure all files and directories are created. The steps below provide the implementation order.

1. **Backend:**
   - Create backend directory structure (see "Required File Structure" section)
   - Create `__init__.py` in backend/ (empty file for Python package)
   - Create Python modules with relative imports (embeddings.py, captioning.py, search.py, admin.py, api.py)
   - Create `seed.py` using template above
   - Create `data/seed_products.json` with data above (20 products, 5 per category)
   - Create `requirements.txt` with dependencies listed in "Environment & Dependencies" section

2. **Frontend:**
   - Scaffold with Vite: `npm create vite@latest frontend -- --template react-ts` (creates base structure)
   - Install dependencies: `cd frontend && npm install && npm install react-router-dom`
   - Create/modify components and services according to "Required File Structure" section:
     - Create all component files in `frontend/src/components/`
     - Create `frontend/src/services/api.ts`
     - Modify `frontend/src/App.tsx` with routing
     - Replace `frontend/src/index.css` with custom styles
     - Update `frontend/vite.config.ts` to set port 3000

3. **Utility Scripts (Required):**
   - Create `deploy.sh` (see "Utility Scripts Requirements" section)
   - Create `destroy.sh` (see "Utility Scripts Requirements" section)
   - Set executable permissions: `chmod +x deploy.sh destroy.sh`

4. **Documentation (Required):**
   - Create `README.md` with basic project info (quick-start guide, prerequisites, usage)
   - Create `Architecture.md` with technical architecture details (system design, data flow, models)

5. **Verification (Required - Part of Build Process):**
   **IMPORTANT:** These verification steps must be executed and actual results reported. Do not skip verification - it ensures the project is functional after build.
   
   **a. Run deploy.sh:**
   - Command: `./deploy.sh`
   - Expected: Prerequisites check, virtual environment creation, dependency installation, servers starting
   - Verify: `curl http://localhost:8000/health` returns `{"status":"healthy","product_count":0}`
   - Verify: Frontend accessible at `http://localhost:3000`
   - Check logs: `backend.log` and `frontend.log` for errors
   - Report: Services started successfully, both servers running
   
   **b. Run seed.py:**
   - Command: `python -m backend.seed` (from project root)
   - Expected: "Created: [product name]" for each of 20 products, "Seeding complete: 20 created, 0 errors"
   - Verify: `curl http://localhost:8000/admin/stats` returns:
     ```json
     {
       "total": 20,
       "by_category": {
         "Tent": 5,
         "Backpack": 5,
         "Sleeping Bag": 5,
         "Cooking": 5
       }
     }
     ```
   - Report: Database seeded successfully, 20 products created (5 per category)
   
   **c. Run destroy.sh:**
   - Command: `./destroy.sh`
   - Expected: Services stopped, cleanup completed
   - Verify: `lsof -ti:8000` and `lsof -ti:3000` return nothing (ports free)
   - Verify: `backend.pid` and `frontend.pid` files removed
   - Report: All services stopped successfully, ports freed


---

**End of Specification**
